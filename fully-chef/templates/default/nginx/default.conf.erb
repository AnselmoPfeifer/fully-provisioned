# Generated by chef
server {
  listen 80 default_server;
  listen [::]:80 default_server;

  root <%= @default_directory %>;
  index index.php index.html index.htm index.nginx-debian.html;

  server_name localhost;
  server_name <%= @ip_address %>;
<% @domains.each do | domain | %>
  server_name <%= domain %>;
<% end %>

  access_log <%= @log_dir %>/access.log;
  error_log <%= @log_dir %>/error.log;

  location / {
    try_files $uri $uri/ =404;
  }

  location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/run/php/php7.0-fpm.sock;
  }

  location /blacklisted {
    alias <%= @default_directory %>/blacklisted;
    try_files $uri $uri/ @nested;

    access_log <%= @log_dir %>/blacklisted_access.log;
    error_log <%= @log_dir %>/blacklisted_error.log;
    include blockips.conf;
  }
}